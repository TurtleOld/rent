{% extends "base.html" %}

{% block title %}Детали услуги - EPD Parser{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item">
                        <a href="{% url 'epd_parser:flexible_service_list' %}">Гибкие услуги</a>
                    </li>
                    <li class="breadcrumb-item active">Детали услуги</li>
                </ol>
            </nav>

            <div class="row">
                <div class="col-md-8">
                    <h1 class="mb-4">{{ service.service_name }}</h1>
                    
                    <!-- Основная информация -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Основная информация</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>Документ:</strong> {{ document.account_number }}</p>
                                    <p><strong>Период:</strong> {{ document.payment_period }}</p>
                                    <p><strong>Плательщик:</strong> {{ document.full_name }}</p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>Структура данных:</strong> 
                                        <span class="badge bg-info">{{ structure_info }}</span>
                                    </p>
                                    <p><strong>Порядок:</strong> {{ service.order }}</p>
                                    <p><strong>Единица измерения:</strong> 
                                        {% if service.unit %}{{ service.unit }}{% else %}-{% endif %}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Финансовые данные -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Финансовые данные</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="text-center">
                                        <h4 class="text-primary">{{ service.amount|floatformat:2 }} ₽</h4>
                                        <small class="text-muted">Начислено</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="text-center">
                                        <h4 class="text-success">{{ service.total|floatformat:2 }} ₽</h4>
                                        <small class="text-muted">Итого к оплате</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="text-center">
                                        <h4 class="text-info">{{ service.recalculation|floatformat:2 }} ₽</h4>
                                        <small class="text-muted">Перерасчет</small>
                                    </div>
                                </div>
                            </div>
                            
                            <hr>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>Долг:</strong> 
                                        {% if service.has_debt %}
                                            <span class="text-danger">{{ service.debt|floatformat:2 }} ₽</span>
                                        {% else %}
                                            <span class="text-muted">-</span>
                                        {% endif %}
                                    </p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>Оплачено:</strong> 
                                        {% if service.has_paid %}
                                            <span class="text-success">{{ service.paid|floatformat:2 }} ₽</span>
                                        {% else %}
                                            <span class="text-muted">-</span>
                                        {% endif %}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Технические данные -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Технические данные</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>Объем:</strong> 
                                        {% if service.has_volume %}
                                            {{ service.volume|floatformat:4 }}
                                        {% else %}
                                            <span class="text-muted">-</span>
                                        {% endif %}
                                    </p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>Тариф:</strong> 
                                        {% if service.has_tariff %}
                                            {{ service.tariff|floatformat:4 }} ₽
                                        {% else %}
                                            <span class="text-muted">-</span>
                                        {% endif %}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <!-- Исходная строка -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Исходная строка</h5>
                        </div>
                        <div class="card-body">
                            <pre class="small text-muted">{{ service.original_line }}</pre>
                        </div>
                    </div>

                    <!-- Флаги структуры -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Структура данных</h5>
                        </div>
                        <div class="card-body">
                            <ul class="list-unstyled">
                                <li>
                                    {% if service.has_volume %}
                                        <span class="badge bg-success">✓</span>
                                    {% else %}
                                        <span class="badge bg-secondary">✗</span>
                                    {% endif %}
                                    Объем
                                </li>
                                <li>
                                    {% if service.has_tariff %}
                                        <span class="badge bg-success">✓</span>
                                    {% else %}
                                        <span class="badge bg-secondary">✗</span>
                                    {% endif %}
                                    Тариф
                                </li>
                                <li>
                                    {% if service.has_recalculation %}
                                        <span class="badge bg-success">✓</span>
                                    {% else %}
                                        <span class="badge bg-secondary">✗</span>
                                    {% endif %}
                                    Перерасчет
                                </li>
                                <li>
                                    {% if service.has_debt %}
                                        <span class="badge bg-success">✓</span>
                                    {% else %}
                                        <span class="badge bg-secondary">✗</span>
                                    {% endif %}
                                    Долг
                                </li>
                                <li>
                                    {% if service.has_paid %}
                                        <span class="badge bg-success">✓</span>
                                    {% else %}
                                        <span class="badge bg-secondary">✗</span>
                                    {% endif %}
                                    Оплачено
                                </li>
                            </ul>
                        </div>
                    </div>

                    <!-- Действия -->
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Действия</h5>
                        </div>
                        <div class="card-body">
                            <a href="{% url 'epd_parser:document_detail' document.pk %}" 
                               class="btn btn-outline-primary btn-sm w-100 mb-2">
                                Просмотр документа
                            </a>
                            <a href="{% url 'epd_parser:flexible_service_list' %}" 
                               class="btn btn-outline-secondary btn-sm w-100">
                                К списку услуг
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} 